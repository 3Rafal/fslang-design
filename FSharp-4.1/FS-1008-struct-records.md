# F# RFC FS-0008 - Struct Records

The design suggestion [Record types can be marked with the Struct attribute](https://fslang.uservoice.com/forums/245727-f-language/suggestions/6547517-record-types-can-be-marked-with-the-struct-attribu) has been marked "approved in principle".
This RFC covers the detailed proposal for this suggestion.

* [x] [Approved in principle](https://fslang.uservoice.com/forums/245727-f-language/suggestions/6547517-record-types-can-be-marked-with-the-struct-attribu)
* [x] Details: [under discussion](https://github.com/dotnet/fsharp/pull/620)
* [x] Implementation: [Complete](https://github.com/dotnet/fsharp/pull/620)


# Summary
[summary]: #summary

Record types should be able to be marked as a struct, effectively making the record have the semantics of value types.

# Motivation
[motivation]: #motivation

Enable better performance in some situations via a simple attribute addition.

# Detailed design
[design]: #detailed-design

How to use:
```fsharp
type Vector3 = { X: float; Y: float; Z: float }
```
Put the `StructAttribute` on the type.
```fsharp
[<Struct>]
type Vector3 = { X: float; Y: float; Z: float }
```

Key differences in struct records:
- Any fields marked as mutable can't be mutated if the corresponding struct instance itself is not marked as mutable. This is how structs work in general for F#.
- You cannot have cyclic references to the same type being defined. ex: ```type T = { X: T }```
- You also cannot call the default ctor, like you could with normal F# structs.
- When marked with the `CLIMutableAttribute`, it will not create a default ctor, because structs implicitly have one, though you can't call it from F#.

# Drawbacks
[drawbacks]: #drawbacks

* People may not understand when to use the attribute, and, like ``inline``, use it inappropriately, giving worse performance.
* People may "fiddle around" applying the attribute when performance is OK or performance gains are more likely to come via other routes
* It's one more trick for F# programmers to learn

# Known issues

* Assemblies built using struct records under this RFC are [not backward-consumable by v4.0 or earlier of the F# compiler](https://github.com/neoeinstein/fsharp-struct-test/blob/master/cns.diff#L354). The IL generated by `fsc.exe` v4.0 attempts to address members and functions using `class` instead of `valuetype`, and thus produces unverifiable code. Libraries generated with struct records SHOULD advertise that they use this construct and are incompatible when consumed by `fsc.exe` and `fsi.exe` v4.0. (See also [comments from the implementing PR](https://github.com/dotnet/fsharp/pull/620#issuecomment-190580488))
